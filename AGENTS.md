# Project Playbook

–î–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: —á—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å –æ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±–æ—Ç–∞, –º–∞—Å—Ç–µ—Ä–∞ –ø–æ—Å—Ç–∞–≤–æ–∫ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **NestJS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –≤ `apps/bot-api/src`.
- **Bot layer** (`bot/`): Telegram-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ (`SupplyWizardStore`), –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫–ª—é—á–µ–π (`UserCredentialsStore`).
- **Ozon –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (`config/` + `ozon/`): `OzonApiService` (HTTP-–∫–ª–∏–µ–Ω—Ç) –∏ –¥–æ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (`OzonSupplyService`, `OzonSheetService`).
- **Storage** (`storage/`): TypeORM —Å—É—â–Ω–æ—Å—Ç–∏ (`user_credentials`, `supply_orders`) –∏ —Å–µ—Ä–≤–∏—Å—ã (`SupplyOrderStore`).
- **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: Dockerfile (`infra/`), GitHub Actions CI (`.github/workflows/ci.yml`). –ë–î ‚Äî SQLite –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`data/bot.sqlite`).

## –ú–∞—Å—Ç–µ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏ (–±—ã—Å—Ç—Ä—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)
1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** ‚Äî `/ozon_auth <CLIENT_ID> <API_KEY>` –∏–ª–∏ —à–∞–≥–∏ –º–∞—Å—Ç–µ—Ä–∞. –ö–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ SQLite –∏ –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö.
2. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞** ‚Äî Excel/Google Sheet (–ê—Ä—Ç–∏–∫—É–ª + –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ). –ü–∞—Ä—Å–∏–º –≤ `OzonSupplyTask`.
3. **–ü–æ–∏—Å–∫ drop-off** ‚Äî —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (`/v1/warehouse/fbo/list`).
4. **–í—ã–±–æ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫, –ø–æ –∫–ª–∏–∫—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º `/v1/cluster/list` c `cluster_ids=[id]` —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ —Å–∫–ª–∞–¥—ã.
5. **–í—ã–±–æ—Ä —Å–∫–ª–∞–¥–∞** ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (10 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É), —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–∫—Å—Ç—É, –∫–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ —Å–ø–∏—Å–∫—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤.
6. **–ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å—ã/—Ç–∞–π–º—Å–ª–æ—Ç—ã** ‚Äî —Å–æ–∑–¥–∞—ë–º/–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫, –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ç–∞–π–º—Å–ª–æ—Ç.
7. **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ—Ç–≥—Ä—É–∑–∫–µ** ‚Äî –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (0,2,3,5,7,10,14,21,28) + —Ä—É—á–Ω–æ–π –≤–≤–æ–¥. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–¥–∞—á–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `supply_orders`, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `processSupplyTask`.
8. **–§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚Äî `SupplyTaskRunnerService` –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–æ–ª–ª–∏–Ω–≥ API, —Å–æ–∑–¥–∞—ë—Ç –ø–æ—Å—Ç–∞–≤–∫—É –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å. –û—Ç–º–µ–Ω–∞ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É ‚Äî —É–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –∏ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç `AbortController`.

## –ö–æ–¥—Å—Ç–∞–π–ª –∏ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è
- TypeScript, strict, 2 –ø—Ä–æ–±–µ–ª–∞, PascalCase –¥–ª—è –∫–ª–∞—Å—Å–æ–≤, kebab-case –¥–ª—è —Ñ–∞–π–ª–æ–≤. –ù–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤.
- –õ—é–±–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ozon ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `OzonApiService`. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ API —Ä–∞—Å—à–∏—Ä—è–µ–º —Å–µ—Ä–≤–∏—Å, –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏.
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `SupplyWizardStore`. –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –ø—Ä–æ–¥—É–º–∞–π—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç–∞–¥–∏—è–º–∏ –∏ —Å–±—Ä–æ—Å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π (`warehouseSearchQuery`, `warehousePage`, `draft*`).
- –í UI –∏—Å–ø–æ–ª—å–∑—É–µ–º `SupplyWizardViewService` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä.
- –°–µ–∫—Ä–µ—Ç—ã/–∫–ª—é—á–∏ –º–∞—Å–∫–∏—Ä—É–µ–º, –≤ –±–∞–∑–µ –ª–µ–∂–∞—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. `/ozon_clear` –æ–±–Ω—É–ª—è–µ—Ç `clientId`/`apiKey` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –º–∞—Å—Ç–µ—Ä.

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è
- README –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–ø–µ—Ä–µ–ø–∏—Å–∞–Ω –ø–æ–¥ —Ç–µ–∫—É—â–∏–π –º–∞—Å—Ç–µ—Ä). –û–±–Ω–æ–≤–ª—è–π—Ç–µ –µ–≥–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —à–∞–≥–æ–≤ –∏–ª–∏ –∫–æ–º–∞–Ω–¥.
- –≠—Ç–æ—Ç Playbook –Ω—É–∂–µ–Ω –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —á–µ–∫-–ª–∏—Å—Ç—ã, –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏.
- Help-—Å–æ–æ–±—â–µ–Ω–∏–µ (`BotUpdate.helpMessage`) –¥–æ–ª–∂–Ω–æ –æ—Ç—Ä–∞–∂–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã.

## –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
1. `yarn install`, `yarn start:dev` ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (polling, SQLite).
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ–∏—á–∏/—Ñ–∏–∫—Å—ã. –î–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ ‚Äî unit-—Ç–µ—Å—Ç—ã (–µ—â—ë –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è).
3. –ü–µ—Ä–µ–¥ –ø—É—à–µ–º ‚Äî `yarn build` + —Ä—É—á–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞: –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞, –≤—ã–±–æ—Ä drop-off, –≤—ã–±–æ—Ä/–ø–æ–∏—Å–∫ —Å–∫–ª–∞–¥–æ–≤, –≤–æ–∑–≤—Ä–∞—Ç –∫ –∫–ª–∞—Å—Ç–µ—Ä—É, –≤—ã–±–æ—Ä –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏, –æ—Ç–º–µ–Ω–∞.
4. –ö–æ–º–º–∏—Ç—ã –∫–æ—Ä–æ—Ç–∫–∏–µ –≤ –ø–æ–≤–µ–ª–∏—Ç–µ–ª—å–Ω–æ–º –Ω–∞–∫–ª–æ–Ω–µ–Ω–∏–∏. PR: –º–æ—Ç–∏–≤–∞—Ü–∏—è, —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ.

## CI / CD
- GitHub Actions: `ci.yml` ‚Äî `yarn install`, `yarn build`, Docker build/push –≤ GHCR.
- Dockerfile (`infra/Dockerfile`) ‚Äî multi-stage (build + runtime). –í runtime –º—ã—à –∏–∑ `dist/main.js`.
- Production (webhook) —Ç—Ä–µ–±—É–µ—Ç `WEBHOOK_DOMAIN` –∏ `WEBHOOK_PATH`. Development ‚Äî long polling.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º
- [ ] README/AGENTS.md –∞–∫—Ç—É–∞–ª—å–Ω—ã.
- [ ] `yarn build` –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫.
- [ ] `/ozon_keys` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, `/ozon_clear` —á–∏—Å—Ç–∏—Ç –∑–∞–ø–∏—Å—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –º–∞—Å—Ç–µ—Ä.
- [ ] –í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∏—Å–∫ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è —Å–∫–ª–∞–¥–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.
- [ ] –¢–∞–π–º—Å–ª–æ—Ç—ã/–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å ‚Äî –±–æ—Ç –∂–¥—ë—Ç –≤—ã–±–æ—Ä–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å.
- [ ] –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–¥–∞—á–∏ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–µ–∫—Ä–∞—â–∞—é—Ç—Å—è (AbortController).

–°–æ–±–ª—é–¥–∞—è —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞, –∫–æ–º–∞–Ω–¥–∞ –±—ã—Å—Ç—Ä–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ –∏ —Å–º–æ–∂–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å –±–æ—Ç–∞ –±–µ–∑ —Ä–µ–≥—Ä–µ—Å—Å–∏–π. –£–¥–∞—á–∏ üëã
